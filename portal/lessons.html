<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lessons — The Modern Student Portal</title>
    <link rel="stylesheet" href="../assets/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <a href="../index.html" class="navbar-logo">
            <svg viewBox="0 0 100 100" fill="none"><defs><linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#a78bfa"/><stop offset="100%" style="stop-color:#f472b6"/></linearGradient></defs><path d="M25 70 V35 L42 55 L50 42 L58 55 L75 35 V70" stroke="url(#logoGrad)" stroke-width="5" stroke-linecap="round" stroke-linejoin="round" fill="none"/><circle cx="50" cy="78" r="4" fill="url(#logoGrad)"/></svg>
            <span>The Modern Student</span>
        </a>
        <div class="navbar-right">
            <div class="account-dropdown" id="accountDropdown">
                <button class="account-trigger">
                    <div class="account-avatar">U</div>
                    <div class="account-info">
                        <span class="account-email">Loading...</span>
                        <span class="account-badge course">Course</span>
                    </div>
                    <svg class="account-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                </button>
                <div class="account-menu">
                    <a href="settings.html" class="account-menu-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><circle cx="12" cy="12" r="3"/></svg>
                        Settings
                    </a>
                    <div class="account-menu-divider"></div>
                    <button class="account-menu-item logout" onclick="logout()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
                        Log Out
                    </button>
                </div>
            </div>
            <button class="btn btn-ghost btn-sm" id="sidebarToggle" style="display: none;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/></svg>
            </button>
        </div>
    </nav>

    <div class="portal-layout">
        <!-- Sidebar -->
        <aside class="portal-sidebar">
            <div class="sidebar-section">
                <div class="sidebar-label">Learn</div>
                <nav class="sidebar-nav">
                    <a href="index.html" class="sidebar-link">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                        Dashboard
                    </a>
                    <a href="lessons.html" class="sidebar-link active">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
                        Lessons
                    </a>
                </nav>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-label">Resources</div>
                <nav class="sidebar-nav">
                    <a href="workflows.html" class="sidebar-link">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
                        Workflows
                    </a>
                    <a href="templates.html" class="sidebar-link">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                        Templates
                    </a>
                    <a href="resources.html" class="sidebar-link">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
                        Resources
                    </a>
                </nav>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-label">Account</div>
                <nav class="sidebar-nav">
                    <a href="settings.html" class="sidebar-link">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><circle cx="12" cy="12" r="3"/></svg>
                        Settings
                    </a>
                    <button class="sidebar-link" onclick="logout()" style="width: 100%; text-align: left; background: none; border: none; cursor: pointer;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
                        Log Out
                    </button>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="portal-main">
            <!-- Header -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;">
                <div>
                    <h2 style="margin-bottom: 4px;">All Lessons</h2>
                    <p class="text-secondary" style="font-size: 14px;">6 modules • 24 micro-lessons</p>
                </div>
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <select id="moduleFilter" class="form-input" style="width: auto; padding: 8px 12px; font-size: 13px;">
                        <option value="all">All Modules</option>
                        <option value="1">Module 1: Foundations</option>
                        <option value="2">Module 2: Study Systems</option>
                        <option value="3">Module 3: Writing</option>
                        <option value="4">Module 4: Research</option>
                        <option value="5">Module 5: Productivity</option>
                        <option value="6">Module 6: Exam Prep</option>
                    </select>
                    <select id="statusFilter" class="form-input" style="width: auto; padding: 8px 12px; font-size: 13px;">
                        <option value="all">All Status</option>
                        <option value="completed">Completed</option>
                        <option value="incomplete">Not Completed</option>
                    </select>
                </div>
            </div>

            <!-- Progress Overview -->
            <div class="card" style="margin-bottom: 32px; padding: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <span style="font-size: 14px; color: var(--color-text-tertiary);">Overall Progress</span>
                    <span class="text-gradient" style="font-weight: 700;" data-progress-text>0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" data-progress-fill style="width: 0%;"></div>
                </div>
            </div>

            <!-- Module 1 -->
            <div class="module-section" data-module="1">
                <div class="module-header">
                    <div class="module-badge">Module 1</div>
                    <h3 class="module-title">Foundations</h3>
                    <p class="module-subtitle">Understanding AI and setting up for success</p>
                </div>
                <div class="lessons-grid">
                    <a href="lesson.html?id=1-1" class="lesson-card" data-lesson="1-1">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">1.1</span>
                        </div>
                        <div class="lesson-info">
                            <h4>How AI Actually Works</h4>
                            <p>Understand the basics of LLMs and why prompts matter</p>
                            <div class="lesson-meta">
                                <span>8 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=1-2" class="lesson-card" data-lesson="1-2">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">1.2</span>
                        </div>
                        <div class="lesson-info">
                            <h4>The Ethics Framework</h4>
                            <p>Where's the line? Understanding academic integrity with AI</p>
                            <div class="lesson-meta">
                                <span>12 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=1-3" class="lesson-card" data-lesson="1-3">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">1.3</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Choosing Your Tools</h4>
                            <p>ChatGPT vs Claude vs Gemini: picking the right AI</p>
                            <div class="lesson-meta">
                                <span>10 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=1-4" class="lesson-card" data-lesson="1-4">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">1.4</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Your First Prompt</h4>
                            <p>From vague to precise: crafting effective requests</p>
                            <div class="lesson-meta">
                                <span>15 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Module 2 -->
            <div class="module-section" data-module="2">
                <div class="module-header">
                    <div class="module-badge">Module 2</div>
                    <h3 class="module-title">Study Systems</h3>
                    <p class="module-subtitle">AI-powered learning and retention techniques</p>
                </div>
                <div class="lessons-grid">
                    <a href="lesson.html?id=2-1" class="lesson-card" data-lesson="2-1">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">2.1</span>
                        </div>
                        <div class="lesson-info">
                            <h4>The Feynman Technique + AI</h4>
                            <p>Use AI to test and deepen your understanding</p>
                            <div class="lesson-meta">
                                <span>11 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=2-2" class="lesson-card" data-lesson="2-2">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">2.2</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Smart Flashcard Generation</h4>
                            <p>Create effective flashcards from any material</p>
                            <div class="lesson-meta">
                                <span>9 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=2-3" class="lesson-card" data-lesson="2-3">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">2.3</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Lecture Note Enhancement</h4>
                            <p>Transform messy notes into structured study guides</p>
                            <div class="lesson-meta">
                                <span>13 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=2-4" class="lesson-card" data-lesson="2-4">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">2.4</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Concept Mapping with AI</h4>
                            <p>Visualize connections between ideas</p>
                            <div class="lesson-meta">
                                <span>10 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Module 3 -->
            <div class="module-section" data-module="3">
                <div class="module-header">
                    <div class="module-badge">Module 3</div>
                    <h3 class="module-title">Writing</h3>
                    <p class="module-subtitle">Ethical AI assistance for academic writing</p>
                </div>
                <div class="lessons-grid">
                    <a href="lesson.html?id=3-1" class="lesson-card" data-lesson="3-1">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">3.1</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Brainstorming & Outlining</h4>
                            <p>Generate ideas and structure without writing for you</p>
                            <div class="lesson-meta">
                                <span>14 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=3-2" class="lesson-card" data-lesson="3-2">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">3.2</span>
                        </div>
                        <div class="lesson-info">
                            <h4>The Feedback Loop</h4>
                            <p>Get constructive criticism on YOUR writing</p>
                            <div class="lesson-meta">
                                <span>12 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=3-3" class="lesson-card" data-lesson="3-3">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">3.3</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Citation & Source Finding</h4>
                            <p>Research assistance without fabrication</p>
                            <div class="lesson-meta">
                                <span>11 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=3-4" class="lesson-card" data-lesson="3-4">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">3.4</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Editing & Proofreading</h4>
                            <p>Polish your work while keeping your voice</p>
                            <div class="lesson-meta">
                                <span>10 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Module 4 -->
            <div class="module-section" data-module="4">
                <div class="module-header">
                    <div class="module-badge">Module 4</div>
                    <h3 class="module-title">Research</h3>
                    <p class="module-subtitle">Finding, analyzing, and synthesizing information</p>
                </div>
                <div class="lessons-grid">
                    <a href="lesson.html?id=4-1" class="lesson-card" data-lesson="4-1">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">4.1</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Research Question Refinement</h4>
                            <p>Sharpen your focus with AI brainstorming</p>
                            <div class="lesson-meta">
                                <span>9 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=4-2" class="lesson-card" data-lesson="4-2">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">4.2</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Literature Review Strategies</h4>
                            <p>Summarize papers and identify key themes</p>
                            <div class="lesson-meta">
                                <span>15 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=4-3" class="lesson-card" data-lesson="4-3">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">4.3</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Data Interpretation Help</h4>
                            <p>Understand statistics and research findings</p>
                            <div class="lesson-meta">
                                <span>13 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=4-4" class="lesson-card" data-lesson="4-4">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">4.4</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Fact-Checking & Verification</h4>
                            <p>Validate AI outputs and avoid hallucinations</p>
                            <div class="lesson-meta">
                                <span>11 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Module 5 -->
            <div class="module-section" data-module="5">
                <div class="module-header">
                    <div class="module-badge">Module 5</div>
                    <h3 class="module-title">Productivity</h3>
                    <p class="module-subtitle">Time management and workflow optimization</p>
                </div>
                <div class="lessons-grid">
                    <a href="lesson.html?id=5-1" class="lesson-card" data-lesson="5-1">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">5.1</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Weekly Planning with AI</h4>
                            <p>Create realistic study schedules that stick</p>
                            <div class="lesson-meta">
                                <span>10 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=5-2" class="lesson-card" data-lesson="5-2">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">5.2</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Assignment Breakdown</h4>
                            <p>Turn overwhelming projects into manageable tasks</p>
                            <div class="lesson-meta">
                                <span>12 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=5-3" class="lesson-card" data-lesson="5-3">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">5.3</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Email & Communication</h4>
                            <p>Draft professional messages efficiently</p>
                            <div class="lesson-meta">
                                <span>8 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=5-4" class="lesson-card" data-lesson="5-4">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">5.4</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Building Your AI Toolkit</h4>
                            <p>Create a personalized system that works for you</p>
                            <div class="lesson-meta">
                                <span>14 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Module 6 -->
            <div class="module-section" data-module="6">
                <div class="module-header">
                    <div class="module-badge">Module 6</div>
                    <h3 class="module-title">Exam Prep</h3>
                    <p class="module-subtitle">AI-assisted test preparation strategies</p>
                </div>
                <div class="lessons-grid">
                    <a href="lesson.html?id=6-1" class="lesson-card" data-lesson="6-1">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">6.1</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Practice Question Generation</h4>
                            <p>Create custom practice tests from your materials</p>
                            <div class="lesson-meta">
                                <span>11 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=6-2" class="lesson-card" data-lesson="6-2">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">6.2</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Concept Deep Dives</h4>
                            <p>Master difficult topics through dialogue</p>
                            <div class="lesson-meta">
                                <span>13 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=6-3" class="lesson-card" data-lesson="6-3">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">6.3</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Memory Techniques</h4>
                            <p>AI-generated mnemonics and memory palaces</p>
                            <div class="lesson-meta">
                                <span>10 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                    <a href="lesson.html?id=6-4" class="lesson-card" data-lesson="6-4">
                        <div class="lesson-thumbnail">
                            <span class="lesson-number">6.4</span>
                        </div>
                        <div class="lesson-info">
                            <h4>Exam Day Strategies</h4>
                            <p>Last-minute prep and confidence building</p>
                            <div class="lesson-meta">
                                <span>9 min</span>
                                <span class="lesson-status" data-status></span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <style>
        @media (max-width: 1024px) {
            #sidebarToggle { display: block !important; }
        }
        .module-section {
            margin-bottom: 48px;
        }
        .module-header {
            margin-bottom: 20px;
        }
        .module-badge {
            display: inline-block;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-accent-purple);
            background: rgba(167, 139, 250, 0.12);
            padding: 4px 10px;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        .module-title {
            font-size: 1.25rem;
            margin-bottom: 4px;
        }
        .module-subtitle {
            font-size: 14px;
            color: var(--color-text-tertiary);
        }
        .lessons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }
        .lesson-card {
            display: flex;
            gap: 16px;
            padding: 16px;
            background: var(--color-glass);
            border: 1px solid var(--color-border-subtle);
            border-radius: 12px;
            text-decoration: none;
            transition: all 0.2s;
        }
        .lesson-card:hover {
            background: var(--color-glass-light);
            border-color: var(--color-border-default);
            transform: translateY(-2px);
        }
        .lesson-card.completed {
            border-color: rgba(52, 211, 153, 0.3);
        }
        .lesson-thumbnail {
            width: 56px;
            height: 56px;
            background: var(--gradient-primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .lesson-number {
            color: white;
            font-weight: 700;
            font-size: 14px;
        }
        .lesson-info {
            flex: 1;
            min-width: 0;
        }
        .lesson-info h4 {
            font-size: 14px;
            margin-bottom: 4px;
            color: var(--color-text-primary);
        }
        .lesson-info p {
            font-size: 12px;
            color: var(--color-text-tertiary);
            line-height: 1.4;
            margin-bottom: 8px;
        }
        .lesson-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: var(--color-text-tertiary);
        }
        .lesson-status {
            display: none;
            align-items: center;
            gap: 4px;
            color: var(--color-accent-green);
            font-weight: 600;
        }
        .lesson-status.show {
            display: flex;
        }
        .lesson-status::before {
            content: '✓';
            font-weight: 700;
        }

        /* Completed lesson card styling */
        .lesson-card.completed {
            border-color: rgba(52, 211, 153, 0.3);
            background: linear-gradient(135deg, rgba(52, 211, 153, 0.05) 0%, transparent 100%);
        }
        .lesson-card.completed .lesson-thumbnail {
            position: relative;
        }
        .lesson-card.completed .lesson-thumbnail::after {
            content: '✓';
            position: absolute;
            bottom: -4px;
            right: -4px;
            width: 20px;
            height: 20px;
            background: var(--color-accent-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: 700;
            border: 2px solid var(--color-bg-primary);
        }
        .lesson-card.completed .lesson-number {
            opacity: 0.8;
        }

        /* Module progress indicator */
        .module-header {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
        }
        .module-progress-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--color-text-tertiary);
        }
        .module-progress-indicator .progress-dots {
            display: flex;
            gap: 4px;
        }
        .module-progress-indicator .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-glass-light);
            border: 1px solid var(--color-border-subtle);
        }
        .module-progress-indicator .dot.completed {
            background: var(--color-accent-green);
            border-color: var(--color-accent-green);
        }
    </style>

    <script src="../assets/main.js"></script>
    <script src="../assets/supabase.js"></script>
    <script src="../assets/portal.js"></script>
    <script>
        // Filter functionality
        const moduleFilter = document.getElementById('moduleFilter');
        const statusFilter = document.getElementById('statusFilter');
        const moduleSections = document.querySelectorAll('.module-section');
        const lessonCards = document.querySelectorAll('.lesson-card');

        // Get progress using the portal.js system
        function getProgress() {
            // Use portal.js function if available, otherwise check localStorage
            if (typeof getProgressSync === 'function') {
                return getProgressSync();
            }
            // Fallback to localStorage
            const stored = localStorage.getItem('tms_lesson_progress');
            return stored ? JSON.parse(stored) : {};
        }

        function isLessonCompleted(lessonId) {
            const progress = getProgress();
            return progress[lessonId]?.completed === true;
        }

        function applyFilters() {
            const selectedModule = moduleFilter.value;
            const selectedStatus = statusFilter.value;

            moduleSections.forEach(section => {
                const moduleNum = section.dataset.module;
                const moduleMatch = selectedModule === 'all' || selectedModule === moduleNum;

                if (moduleMatch) {
                    section.style.display = '';

                    const cards = section.querySelectorAll('.lesson-card');
                    let visibleCount = 0;

                    cards.forEach(card => {
                        const lessonId = card.dataset.lesson;
                        const isCompleted = isLessonCompleted(lessonId);
                        const statusMatch = selectedStatus === 'all' ||
                            (selectedStatus === 'completed' && isCompleted) ||
                            (selectedStatus === 'incomplete' && !isCompleted);

                        if (statusMatch) {
                            card.style.display = '';
                            visibleCount++;
                        } else {
                            card.style.display = 'none';
                        }
                    });

                    // Hide module if no visible lessons
                    if (visibleCount === 0 && selectedStatus !== 'all') {
                        section.style.display = 'none';
                    }
                } else {
                    section.style.display = 'none';
                }
            });
        }

        moduleFilter.addEventListener('change', applyFilters);
        statusFilter.addEventListener('change', applyFilters);

        // Update lesson completion status on page load
        function updateLessonStatuses() {
            lessonCards.forEach(card => {
                const lessonId = card.dataset.lesson;
                const statusEl = card.querySelector('.lesson-status');
                const isCompleted = isLessonCompleted(lessonId);

                if (isCompleted) {
                    card.classList.add('completed');
                    if (statusEl) {
                        statusEl.classList.add('show');
                        statusEl.textContent = 'Completed';
                    }
                } else {
                    card.classList.remove('completed');
                    if (statusEl) {
                        statusEl.classList.remove('show');
                        statusEl.textContent = '';
                    }
                }
            });

            // Update module progress indicators
            updateModuleProgress();
        }

        // Add module progress dots
        function updateModuleProgress() {
            moduleSections.forEach(section => {
                const moduleNum = section.dataset.module;
                const cards = section.querySelectorAll('.lesson-card');
                const header = section.querySelector('.module-header');

                // Remove existing progress indicator
                const existingIndicator = header.querySelector('.module-progress-indicator');
                if (existingIndicator) existingIndicator.remove();

                // Count completed lessons in this module
                let completedCount = 0;
                const totalCount = cards.length;

                cards.forEach(card => {
                    const lessonId = card.dataset.lesson;
                    if (isLessonCompleted(lessonId)) {
                        completedCount++;
                    }
                });

                // Create progress indicator
                const indicator = document.createElement('div');
                indicator.className = 'module-progress-indicator';

                // Create dots
                let dotsHTML = '<div class="progress-dots">';
                for (let i = 0; i < totalCount; i++) {
                    dotsHTML += `<div class="dot ${i < completedCount ? 'completed' : ''}"></div>`;
                }
                dotsHTML += '</div>';

                indicator.innerHTML = `
                    ${dotsHTML}
                    <span>${completedCount}/${totalCount}</span>
                `;

                header.appendChild(indicator);
            });
        }

        // Initialize after portal.js loads progress
        function initLessonsPage() {
            updateLessonStatuses();
        }

        // Wait a bit for portal.js to fetch progress from Supabase
        setTimeout(initLessonsPage, 500);

        // Also update immediately with cached/localStorage data
        updateLessonStatuses();
    </script>
</body>
</html>
